(this.webpackJsonpchat_client=this.webpackJsonpchat_client||[]).push([[0],{228:function(e,t,n){e.exports=n(389)},233:function(e,t,n){},389:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(50),s=n.n(o),c=(n(233),n(65)),l=n(23),i=n(24),u=n(26),d=n(25),m=n(27),g=n(197),h=n(405),v=n(398),p=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(u.a)(this,Object(d.a)(t).call(this,e))).sendMessage=function(){var e=n.state.message;n.props.handleSend(e)},n.clearMessage=function(){n.setState({message:""})},n.handleKeyDown=function(e){"Enter"===e.key&&n.state.message.length>0&&(n.sendMessage(),n.clearMessage())},n.state={message:""},n}return Object(m.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement("div",{style:{margin:"0px 50px",width:"100vw"}},r.a.createElement(v.a,{fluid:!0,value:this.state.message,placeholder:"Enter message...",onChange:function(t){e.setState({message:t.target.value})},onKeyDown:this.handleKeyDown}))}}]),t}(r.a.Component),E=n(403),f=function(e){var t=e.hstyle,n=e.color,a=e.text;return r.a.createElement("div",null,r.a.createElement(E.a,{style:{width:"100%"},as:t,inverted:!0,color:n,block:!0,textAlign:"center"},a))},b=n(404),S=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(u.a)(this,Object(d.a)(t).call(this,e))).scrollToBottom=function(){n.messagesEnd.scrollIntoView({behavior:"smooth"})},n}return Object(m.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){this.scrollToBottom()}},{key:"componentDidUpdate",value:function(){this.scrollToBottom()}},{key:"render",value:function(){var e=this;return r.a.createElement("div",null,this.props.msgList.map((function(e,t){return r.a.createElement(b.a,{key:t},e)})),r.a.createElement("div",{style:{float:"left",clear:"both"},ref:function(t){e.messagesEnd=t}}))}}]),t}(r.a.Component),O=function(e){var t=e.userList;return r.a.createElement("div",null,t.map((function(e){return r.a.createElement(h.a.Row,{key:e,style:{padding:"10px",overflow:"hidden",textAlign:"center"}},r.a.createElement("p",{style:{width:"break-word"}},e))})))};function L(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function j(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?L(n,!0).forEach((function(t){Object(g.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):L(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var y=function(e){function t(e){return Object(l.a)(this,t),Object(u.a)(this,Object(d.a)(t).call(this,e))}return Object(m.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e={border:"1px solid black",height:"80vh",overflowY:"scroll"};return r.a.createElement("div",null,r.a.createElement(f,{hstyle:"h2",color:"violet",text:"CS291 Chat App"}),r.a.createElement(h.a,{columns:2},r.a.createElement(h.a.Row,null,r.a.createElement(h.a.Column,{width:2,style:j({},e,{},{paddingRight:"0"})},r.a.createElement(f,{hstyle:"h5",color:"violet",text:"Online Users"}),r.a.createElement(O,{userList:this.props.userList})),r.a.createElement(h.a.Column,{width:14,style:j({},e,{},{padding:"10px",width:"80vw"})},r.a.createElement(S,{msgList:this.props.msgList}))),r.a.createElement(h.a.Row,{width:16},r.a.createElement(p,{handleSend:this.props.handleSend}))))}}]),t}(r.a.Component),w=n(400),k=n(399),U=n(402),C=n(390),D=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(u.a)(this,Object(d.a)(t).call(this,e))).submitLogin=function(e){console.log("submitting login");var t=n.state,a=t.chatUrl,r=t.password,o=t.username;e.preventDefault();var s={chatUrl:a,password:r,username:o};n.props.submitLogin(s)},n.state={chatUrl:"",password:"",username:""},n}return Object(m.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){var e=this,t=this.state,n=t.chatUrl,a=t.password,o=t.username,s={color:"blue",size:"small",type:"submit",disabled:!o||!a||!n};return r.a.createElement("div",null,r.a.createElement(k.a,null,r.a.createElement(k.a.Field,{required:!0,onSubmit:this.submitLogin},r.a.createElement("label",null,"Chat URL"),r.a.createElement(v.a,{fluid:!0,placeholder:"Enter chat url...",name:"chatUrl",type:"text",value:n,onChange:function(t){e.setState({chatUrl:t.target.value})}})),r.a.createElement(k.a.Field,{required:!0,onChange:function(t){0!==e.props.loginError&&e.props.clearLoginError()}},r.a.createElement("label",null,"Username"),r.a.createElement(v.a,{fluid:!0,placeholder:"Enter Username...",name:"username",type:"text",value:o,onChange:function(t){e.setState({username:t.target.value})}})),r.a.createElement(k.a.Field,{required:!0,onChange:function(t){0!==e.props.loginError&&e.props.clearLoginError()}},r.a.createElement("label",null,"Password"),r.a.createElement(v.a,{fluid:!0,placeholder:"Enter Password...",name:"password",type:"password",value:a,onChange:function(t){e.setState({password:t.target.value})}}),""!==this.props.loginError&&r.a.createElement(U.a,{negative:!0},this.props.loginError)),r.a.createElement(C.a,Object.assign({},s,{onClick:this.submitLogin}),"Login")))}}]),t}(r.a.Component),T=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(u.a)(this,Object(d.a)(t).call(this,e))).state={formFields:{}},n.submitLogin=function(e){console.log("LoginForm fields: "),console.log(e),n.props.handleLoginSubmit(e)},n}return Object(m.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){var e={centered:!0,open:!this.props.connected,size:"small"};return r.a.createElement("div",null,r.a.createElement(w.a,Object.assign({},e,{style:{marginTop:"-20vh"}}),r.a.createElement(w.a.Content,null,r.a.createElement(D,{clearLoginError:this.props.clearLoginError,loginError:this.props.loginErrors,submitLogin:this.submitLogin}))))}}]),t}(r.a.Component),F=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(u.a)(this,Object(d.a)(t).call(this,e))).dateFormat=function(e){var t=new Date(1e3*e);return t.toLocaleDateString("en-US")+" "+t.toLocaleTimeString("en-US")},n.setupEventSource=function(e,t){var a=n.state.token;n.eventSource=new EventSource(e+"/stream/"+a),n.setState({chatUrl:e,connected:!0}),n.handleDisconnect=function(){n.setState({chatUrl:"",token:"",connected:!1,username:"",msgList:[],userList:[],loginError:""})},n.eventSource.addEventListener("Disconnect",(function(e){console.log("Got Disconnect Event"),n.handleDisconnect(),n.eventSource.close()})),n.eventSource.addEventListener("Join",(function(e){console.log("Got Join Event");var t=JSON.parse(e.data);console.log(t.user+" joined");var a=n.dateFormat(t.created);-1===n.state.userList.indexOf(t.user)&&t.user!==n.state.username&&n.setState((function(e){return{userList:[].concat(Object(c.a)(e.userList),[t.user])}})),n.setState((function(e){return{msgList:[].concat(Object(c.a)(e.msgList),["".concat(a," JOIN: ").concat(t.user)])}})),console.log("new msg list: "+n.state.msgList)})),n.eventSource.addEventListener("Message",(function(e){console.log("Got Message Event");var t=JSON.parse(e.data);console.log("created: ",t.created);var a=n.dateFormat(t.created);n.setState((function(n){return{msgList:[].concat(Object(c.a)(n.msgList),["".concat(a," (").concat(t.user,") ").concat(t.message)]),lastEventId:e.lastEventId,lastEvent:"".concat(a," STATUS: ").concat(t.status)}})),console.log("lastEventId: ",n.state.lastEventId),console.log("lastEvent: ",n.state.lastEvent)})),n.eventSource.addEventListener("Part",(function(e){console.log("Got Part Event");var t=JSON.parse(e.data),a=n.dateFormat(t.created);n.setState((function(e){return{userList:e.userList.filter((function(e){return e!==t.user}))}})),console.log("new list: "+n.state.userList),n.setState((function(e){return{msgList:[].concat(Object(c.a)(e.msgList),["".concat(a," PART: ").concat(t.user)])}}))})),n.eventSource.addEventListener("ServerStatus",(function(e){console.log("Got ServerStatus Event");var t=JSON.parse(e.data),a=n.dateFormat(t.created);n.setState((function(n){return{msgList:[].concat(Object(c.a)(n.msgList),["".concat(a," STATUS: ").concat(t.status)]),lastEventId:e.lastEventId,lastEvent:"".concat(a," STATUS: ").concat(t.status)}})),console.log("lastEventId: ",n.state.lastEventId),console.log("lastEvent: ",n.state.lastEvent)})),n.eventSource.addEventListener("Users",(function(e){console.log("Got Users Event");var t=JSON.parse(e.data);console.log(t),n.setState({userList:t.users})})),n.eventSource.addEventListener("error",(function(e){console.log("Got error Event")}))},n.clearLoginError=function(){n.setState({loginError:""})},n.convertToForm=function(e){var t=new FormData;for(var n in e)t.append(n,e[n]);return t},n.handleLoginSubmit=function(e){console.log("app handle login fields: "),console.log(e);var t=e.chatUrl,a=(e.lastEventId,e.password),r=e.username,o={username:r,password:a},s=n.convertToForm(o);fetch(t+"/login",{method:"POST",body:s}).then((function(e){403===e.status?(n.setState({loginError:"The username and password do not match."}),console.log("login errors: ",n.state.loginErrors)):201===e.status?e.json().then((function(e){n.setState({token:e.token}),n.setState({username:r}),n.setupEventSource(t,n.clearFields)})):422==e.status&&console.log("Form can only have username and password field and neither can be empty.")}))},n.handleSend=function(e){var t=n.state.chatUrl,a={message:e},r=n.convertToForm(a);fetch(t+"/message",{method:"POST",headers:{Authorization:"Bearer "+n.state.token},body:r}).then((function(e){403===e.status?console.log("Signed token not valid."):422===e.status&&console.log("Form can only have message field and message cannot be empty.")}))},n.eventSource=null,n.state={chatUrl:"",connected:!1,token:"",username:"",msgList:[],userList:[],loginError:"",lastEventId:"",lastEvent:""},n}return Object(m.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this.state,t=e.connected,n=e.loginError,a=e.msgList,o=e.userList;return console.log("userList: "+o),r.a.createElement("div",null,r.a.createElement(y,{connected:t,handleSend:this.handleSend,msgList:a,userList:o}),r.a.createElement(T,{connected:t,clearLoginError:this.clearLoginError,handleLoginSubmit:this.handleLoginSubmit,loginErrors:n}))}}]),t}(r.a.Component);s.a.render(r.a.createElement(F,null),document.getElementById("root"))}},[[228,1,2]]]);
//# sourceMappingURL=main.3608e336.chunk.js.map